<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Muro de Servicios - MS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #007bff;
            --neon-blue: #00e1ff;
            --dark-bg: #0a0a10;
            --panel-bg: rgba(20, 20, 30, 0.95);
            --text-white: #ffffff;
            --card-shadow: 0 0 15px rgba(0, 123, 255, 0.3);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-image: url('https://img.freepik.com/free-photo/abstract-luxury-gradient-blue-background-smooth-dark-blue-with-black-vignette_1258-48251.jpg');
            background-repeat: no-repeat;
            background-attachment: fixed;
            background-size: cover;
            background-position: center center;
            color: var(--text-white);
            min-height: 100vh;
        }

        /* --- ESTILOS GLOBAL --- */
        .navbar {
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--primary);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .brand {
            font-size: 1.5em;
            font-weight: 800;
            color: var(--text-white);
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn-publish {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            box-shadow: 0 0 10px var(--primary);
        }
        .btn-publish:hover { background: var(--neon-blue); color: black; }

        .wall-container {
            max-width: 1200px;
            margin: 30px auto;
            padding: 20px;
        }

        h1 { text-align: center; text-shadow: 2px 2px 4px black; margin-bottom: 30px; }

        /* ESTILOS DEL BUSCADOR */
        .search-container {
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
        }
        .search-input {
            width: 100%;
            max-width: 500px;
            padding: 15px;
            border-radius: 30px;
            border: 2px solid var(--primary);
            background: rgba(0,0,0,0.7);
            color: white;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
            text-align: center;
        }
        .search-input:focus {
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px var(--neon-blue);
        }

        /* NUEVOS ESTILOS PARA LOS BOTONES DE FILTRO */
        .category-filter {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .filter-btn {
            background: rgba(0,0,0,0.6);
            color: #ccc;
            border: 1px solid #444;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .filter-btn:hover {
            border-color: var(--neon-blue);
            color: white;
            transform: translateY(-2px);
        }
        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
        }

        .service-card {
            background: var(--panel-bg);
            border: 1px solid #333;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            flex-direction: column;
        }

        .service-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0 20px var(--primary);
            border-color: var(--neon-blue);
        }

        .edit-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        .edit-btn:hover { background: var(--neon-blue); color: black; }

        .card-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 2px solid var(--primary);
        }

        .card-body { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }

        .card-category {
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8em;
            text-transform: uppercase;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
            align-self: flex-start;
        }

        .card-title { font-size: 1.4em; font-weight: bold; margin: 0 0 10px 0; color: var(--neon-blue); }
        .card-desc { color: #ccc; font-size: 0.95em; line-height: 1.5; margin-bottom: 15px; flex-grow: 1; }

        .card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #333;
        }

        .card-contact {
            color: var(--text-white);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .card-contact i { color: #25D366; }

        .delete-btn { color: #ff4444; cursor: pointer; background: none; border: none; font-size: 0.9em; }

        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        .modal-overlay.active { display: flex; }

        .modal-content {
            background: #1a1a20;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--primary);
            box-shadow: 0 0 30px rgba(0, 123, 255, 0.5);
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 15px; right: 15px;
            background: none; border: none;
            color: white; font-size: 1.5em; cursor: pointer;
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; color: var(--neon-blue); }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%; padding: 10px;
            background: #0a0a0a; border: 1px solid #444;
            color: white; border-radius: 5px;
            box-sizing: border-box;
        }
        .form-group input:focus { border-color: var(--neon-blue); outline: none; }

        .btn-submit {
            width: 100%; padding: 12px;
            background: var(--primary); color: white;
            border: none; border-radius: 5px;
            font-size: 1.1em; font-weight: bold; cursor: pointer;
        }
        .btn-submit:hover { background: var(--neon-blue); color: black; }
        
        /* ESTILOS ESPEC√çFICOS DEL ACCESO EN EL MODAL */
        .modal-access-panel {
            text-align: center;
            padding: 20px;
        }
        .modal-access-panel input[type="text"] {
            font-size: 1.3em;
            letter-spacing: 3px;
            text-align: center;
        }
        .modal-access-panel button {
            margin-top: 15px;
        }
        
        /* üí° ESTILOS DEL CHATBOT */
        .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 500;
        }
        .chat-icon {
            background: var(--primary); 
            color: white;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2em;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.3s;
        }
        .chat-icon:hover { transform: scale(1.1); }
        .chat-window {
            position: absolute;
            bottom: 70px;
            right: 0;
            width: 300px;
            height: 400px;
            background: #1a1a20;
            border: 1px solid var(--neon-blue);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 225, 255, 0.4);
            display: none; 
            flex-direction: column;
            overflow: hidden;
        }
        .chat-window.active { display: flex; }
        .chat-header {
            background: var(--primary);
            color: white;
            padding: 10px;
            text-align: center;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .chat-header button { background: none; border: none; color: white; cursor: pointer; font-size: 1.2em; }
        .chat-body {
            flex-grow: 1;
            padding: 10px;
            overflow-y: auto;
            background: #0a0a10;
            display: flex;
            flex-direction: column;
        }
        .message { margin-bottom: 10px; max-width: 80%; padding: 8px; border-radius: 10px; }
        .bot-message { background: var(--panel-bg); color: white; align-self: flex-start; }
        .user-message { background: var(--primary); color: white; align-self: flex-end; margin-left: auto; }
        .quick-options { padding: 10px; background: #111; border-top: 1px solid #333; }
        .quick-options button {
            background: #333;
            color: var(--neon-blue);
            border: 1px solid var(--neon-blue);
            padding: 5px 10px;
            margin: 5px 5px 5px 0;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8em;
            transition: 0.2s;
        }
        .quick-options button:hover { background: var(--neon-blue); color: black; }
        .chat-input {
            display: flex;
            padding: 10px;
            background: #111;
        }
        .chat-input input {
            flex-grow: 1;
            padding: 8px;
            border: 1px solid #444;
            background: #0a0a0a;
            color: white;
            border-radius: 5px 0 0 5px;
        }
        .chat-input button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 10px;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }
        /* FIN ESTILOS DEL CHATBOT */

        /* Responsive adjustments */
        @media (max-width: 600px) {
            .navbar { flex-direction: column; gap: 10px; }
            .brand { margin-bottom: 5px; }
            .chat-window { width: 280px; right: -10px; }
        }

    </style>
</head>
<body onload="loadServices()">
    
    <div id="mainContent">
        <nav class="navbar">
            <div class="brand">
                <i class="fas fa-tools"></i> Multi Service RD
            </div>
            <button class="btn-publish" onclick="openModal()">
                <i class="fas fa-plus"></i> Publicar Servicio
            </button>
        </nav>

        <div class="wall-container">
            <h1>üõ† Muro de Servicios Disponibles üß∞</h1>
            
            <!-- BARRA DE B√öSQUEDA -->
            <div class="search-container">
                <input type="text" id="searchInput" class="search-input" placeholder="üîç Buscar servicio, nombre o descripci√≥n..." onkeyup="filterServices()">
            </div>

            <!-- BOTONES DE FILTRO POR CATEGOR√çA (NUEVO) -->
            <div class="category-filter">
                <button class="filter-btn active" onclick="filterByCategory('all', this)">Todos</button>
                <button class="filter-btn" onclick="filterByCategory('Electricidad', this)">‚ö° Electricidad</button>
                <button class="filter-btn" onclick="filterByCategory('Refrigeraci√≥n', this)">‚ùÑÔ∏è Refrigeraci√≥n</button>
                <button class="filter-btn" onclick="filterByCategory('Plomer√≠a', this)">üîß Plomer√≠a</button>
                <button class="filter-btn" onclick="filterByCategory('Tecnolog√≠a', this)">üíª Tecnolog√≠a</button>
                <button class="filter-btn" onclick="filterByCategory('Construcci√≥n', this)">üß± Construcci√≥n</button>
                <button class="filter-btn" onclick="filterByCategory('Limpieza', this)">üßπ Limpieza</button>
                <button class="filter-btn" onclick="filterByCategory('Otros', this)">üõ†Ô∏è Otros</button>
            </div>

            <div class="services-grid" id="servicesGrid">
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="serviceModal">
        <div class="modal-content">
            <button class="close-modal" onclick="closeModal()">&times;</button>
            <h2 id="modalTitle" style="text-align: center; color: var(--neon-blue);">Publicar Servicio</h2>
            
            <div id="modalAccessPanel" class="modal-access-panel">
                <p style="color: #ccc;">üîê Introduce el c√≥digo de seguridad para acceder al formulario de publicaci√≥n.</p>
                <input type="text" id="modalAccessCodeInput" maxlength="4" placeholder="****">
                <button class="btn-publish" onclick="checkModalAccessCode()">Continuar</button>
                <p id="modalAccessFeedback" style="margin-top: 15px; font-weight: bold;"></p> 
            </div>

            <form id="serviceForm" style="display: none;">
                <input type="hidden" id="serviceId"> 
                <div class="form-group">
                    <label>Categor√≠a:</label>
                    <select id="servCat" required>
                        <option value="Electricidad">‚ö° Electricidad</option>
                        <option value="Refrigeraci√≥n">‚ùÑÔ∏è Refrigeraci√≥n</option>
                        <option value="Plomer√≠a">üîß Plomer√≠a</option>
                        <option value="Tecnolog√≠a">üíª Tecnolog√≠a</option>
                        <option value="Construcci√≥n">üß± Construcci√≥n</option>
                        <option value="Limpieza">üßπ Limpieza</option>
                        <option value="Otros">üõ†Ô∏è Otros</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>T√≠tulo del Anuncio:</label>
                    <input type="text" id="servTitle" placeholder="Ej: Electricista Residencial 24/7" required>
                </div>

                <div class="form-group">
                    <label>Foto del Trabajo (URL o Local):</label>
                    <input type="file" id="servImgInput" accept="image/*">
                    <input type="hidden" id="servImgUrl"> 
                    <small style="color:#aaa; font-size: 0.8em;">Im√°genes grandes pueden fallar. Usa im√°genes ligeras o deja vac√≠o.</small>
                </div>

                <div class="form-group">
                    <label>Descripci√≥n:</label>
                    <textarea id="servDesc" rows="3" placeholder="Describe tu experiencia, precios estimados, zona..." required></textarea>
                </div>

                <div class="form-group">
                    <label>WhatsApp / Tel√©fono:</label>
                    <input type="number" id="servPhone" placeholder="Ej: 8095555555" required>
                </div>

                <button type="submit" class="btn-submit">Guardar y Publicar</button>
            </form>
        </div>
    </div>

    <div class="chat-container">
        <div class="chat-icon" onclick="toggleChat()">
            <i class="fas fa-headset"></i>
        </div>

        <div class="chat-window" id="chatWindow">
            <div class="chat-header">
                Soporte MS
                <button onclick="toggleChat()"><i class="fas fa-times"></i></button>
            </div>
            <div class="chat-body" id="chatBody">
                <div class="message bot-message">¬°Hola! Soy tu asistente virtual. ¬øC√≥mo puedo ayudarte hoy?</div>
            </div>
            <div class="quick-options">
                <button onclick="openRegistrationAndCloseChat()">üìù Publicar Servicio Ahora</button>
                <button onclick="sendQuickMessage('¬øC√≥mo funciona el Muro?')">‚ùìFuncionamiento</button>
                <button onclick="sendQuickMessage('Necesito soporte t√©cnico')">üíª Soporte</button>
                <button onclick="sendQuickMessage('Instrucciones de registro')">‚ÑπÔ∏è Instrucciones</button>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." onkeypress="if(event.key === 'Enter') sendMessage()">
                <button onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
    <script>
        // --- C√ìDIGOS DE ACCESO ---
        const VALID_ACCESS_CODES = [
            "8349", "1720", "4561", "9032", "6875", "5104", "2938", "7615", "3487", "0259", 
            "8876", "1345", "4098", "9521", "6730", "3152", "0864", "7493", "5917", "2605", 
            "1093", "6278", "8514", "4307", "9962", "5741", "2483", "7026", "3950", "0179", 
            "6584", "3291", "0753", "8946", "1437", "4625", "9803", "7168", "5379", "2041", 
            "7890", "4123", "9675", "0358", "3514", "2769", "5081", "1934", "6470", "8253", 
            "0617", "3385", "5829", "9401", "4752", "9106", "6328", "2549", "1873", "7054", 
            "3971", "8062", "5210", "4495", "0736", "1609", "7284", "3857", "9320", "5413", 
            "8192", "0573", "6948", "2211", "4735", "7304", "5566", "1298", "8459", "3607", 
            "0947", "6183", "2354", "4872", "9701", "5926", "1140", "7789", "3095", "8632", 
            "4219", "9135", "0487", "6608", "2893", "3756", "8021", "5438", "1904", "7265"
        ];

        let isAuthorizedToPublish = false; 

        // --- L√ìGICA DE ACCESO DENTRO DEL MODAL ---
        function checkModalAccessCode() {
            const inputCode = document.getElementById('modalAccessCodeInput').value.trim();
            const feedback = document.getElementById('modalAccessFeedback');
            
            if (VALID_ACCESS_CODES.includes(inputCode)) {
                feedback.style.color = 'green';
                feedback.innerText = '‚úÖ C√≥digo correcto. Abriendo formulario...';
                isAuthorizedToPublish = true; 
                
                document.getElementById('modalAccessPanel').style.display = 'none';
                document.getElementById('serviceForm').style.display = 'block';
                document.getElementById('modalTitle').innerText = 'Publicar Nuevo Servicio';
                document.getElementById('modalAccessCodeInput').value = ''; 
                feedback.innerText = ''; 
                
            } else {
                feedback.style.color = 'red';
                feedback.innerText = '‚ùå C√≥digo incorrecto. Intenta de nuevo.';
            }
        }
        
        // --- L√ìGICA DE MURO DE SERVICIOS Y MODAL ---
        const modal = document.getElementById('serviceModal');
        const form = document.getElementById('serviceForm');
        
        function openModal() {
            document.getElementById('serviceForm').reset();
            document.getElementById('serviceId').value = ''; 
            document.getElementById('servImgUrl').value = ''; 

            if (isAuthorizedToPublish) {
                document.getElementById('modalAccessPanel').style.display = 'none';
                document.getElementById('serviceForm').style.display = 'block';
                document.getElementById('modalTitle').innerText = 'Publicar Nuevo Servicio';
            } else {
                document.getElementById('modalAccessPanel').style.display = 'block';
                document.getElementById('serviceForm').style.display = 'none';
                document.getElementById('modalTitle').innerText = 'Acceso de Publicaci√≥n';
            }
            modal.classList.add('active');
        }

        function editService(id) {
            if (!isAuthorizedToPublish) {
                openModal();
                document.getElementById('modalAccessFeedback').style.color = 'red';
                document.getElementById('modalAccessFeedback').innerText = 'üîí Necesitas introducir el c√≥digo para editar.';
                return;
            }

            const services = JSON.parse(localStorage.getItem('ms_services')) || [];
            const service = services.find(s => s.id == id);

            if (service) {
                document.getElementById('serviceId').value = service.id;
                document.getElementById('servCat').value = service.category;
                document.getElementById('servTitle').value = service.title;
                document.getElementById('servDesc').value = service.desc;
                document.getElementById('servPhone').value = service.phone;
                document.getElementById('servImgUrl').value = service.image; 
                document.getElementById('servImgInput').value = ''; 
                
                document.getElementById('modalAccessPanel').style.display = 'none';
                document.getElementById('serviceForm').style.display = 'block';

                document.getElementById('modalTitle').innerText = 'Editar Servicio';
                modal.classList.add('active');
            }
        }

        function closeModal() {
            modal.classList.remove('active');
        }

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            if (!isAuthorizedToPublish) {
                alert('ERROR: Necesitas un c√≥digo de acceso v√°lido para enviar el formulario.');
                closeModal();
                return;
            }

            if (!document.getElementById('servCat').value || !document.getElementById('servTitle').value || 
                !document.getElementById('servDesc').value || !document.getElementById('servPhone').value) {
                alert('Por favor, rellena todos los campos obligatorios antes de publicar.');
                return;
            }

            const id = document.getElementById('serviceId').value;
            const fileInput = document.getElementById('servImgInput');
            const currentImgUrl = document.getElementById('servImgUrl').value;
            
            const newService = {
                id: id ? id : Date.now(),
                category: document.getElementById('servCat').value,
                title: document.getElementById('servTitle').value,
                desc: document.getElementById('servDesc').value,
                phone: document.getElementById('servPhone').value,
                image: currentImgUrl || ''
            };

            if (fileInput.files && fileInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(readerEvent) {
                    const res = readerEvent.target.result;
                    if(res.length > 2000000) { 
                         alert('‚ö†Ô∏è La imagen es demasiado grande para guardar en el navegador. Intenta con una m√°s peque√±a.');
                         return;
                    }
                    newService.image = res;
                    saveToLocalStorage(newService);
                };
                reader.onerror = function(error) {
                    console.error('Error al leer el archivo:', error);
                    alert('‚ö†Ô∏è Error al leer imagen.');
                };
                reader.readAsDataURL(fileInput.files[0]);
            } else {
                if (!newService.image) {
                    newService.image = getPlaceholderImage(newService.category);
                }
                saveToLocalStorage(newService);
            }
        });

        function saveToLocalStorage(serviceObj) {
            try {
                let services = JSON.parse(localStorage.getItem('ms_services')) || [];
                const index = services.findIndex(s => s.id == serviceObj.id);

                if (index > -1) {
                    services[index] = serviceObj;
                } else {
                    services.unshift(serviceObj);
                }

                localStorage.setItem('ms_services', JSON.stringify(services));
                closeModal();
                loadServices();
                document.getElementById('searchInput').value = '';
                // Reseteamos filtros a "Todos" visualmente
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn').classList.add('active'); // El primero es Todos

                alert('¬°Servicio publicado/editado con √©xito!');
            } catch (e) {
                console.error('Error al guardar en LocalStorage:', e);
                alert('‚ùå ERROR CR√çTICO: No se pudo guardar. Es probable que la imagen sea muy pesada para el LocalStorage. Intenta sin imagen o con una muy peque√±a.');
            }
        }

        function deleteService(id) {
            if (!isAuthorizedToPublish) {
                alert('üîí Necesitas un c√≥digo de acceso v√°lido para eliminar servicios.');
                openModal();
                return;
            }

            if(confirm('¬øSeguro que quieres borrar este servicio?')) {
                let services = JSON.parse(localStorage.getItem('ms_services')) || [];
                services = services.filter(s => s.id != id);
                localStorage.setItem('ms_services', JSON.stringify(services));
                loadServices();
            }
        }

        // --- FUNCIONES DE FILTRADO (B√öSQUEDA Y CATEGOR√çAS) ---
        
        // 1. Filtrado por texto
        function filterServices() {
            const searchText = document.getElementById('searchInput').value.toLowerCase();
            const services = JSON.parse(localStorage.getItem('ms_services')) || [];
            
            // Si el usuario escribe, quitamos el estado "activo" de las categor√≠as (o ponemos Todos)
            // para indicar que busca globalmente.
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn').classList.add('active'); 
            
            const filteredServices = services.filter(s => {
                return s.title.toLowerCase().includes(searchText) || 
                       s.category.toLowerCase().includes(searchText) ||
                       s.desc.toLowerCase().includes(searchText);
            });
            
            renderGrid(filteredServices);
        }

        // 2. Filtrado por Botones de Categor√≠a (NUEVO)
        function filterByCategory(category, btnElement) {
            // Actualizar estilo visual de botones
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');

            // Limpiar buscador para evitar confusiones
            document.getElementById('searchInput').value = '';

            const services = JSON.parse(localStorage.getItem('ms_services')) || [];

            if (category === 'all') {
                renderGrid(services);
            } else {
                const filtered = services.filter(s => s.category === category);
                renderGrid(filtered);
            }
        }

        function loadServices() {
            const services = JSON.parse(localStorage.getItem('ms_services')) || [];
            renderGrid(services);
        }

        function renderGrid(servicesToRender) {
            const grid = document.getElementById('servicesGrid');
            grid.innerHTML = '';

            if (servicesToRender.length === 0) {
                grid.innerHTML = '<p style="text-align:center; grid-column: 1/-1; color: #aaa;">No se encontraron servicios.</p>';
                return;
            }

            servicesToRender.forEach(s => {
                const card = document.createElement('div');
                card.className = 'service-card';
                card.innerHTML = `
                    <button class="edit-btn" onclick="editService(${s.id})" title="Editar mi servicio"><i class="fas fa-pen"></i></button>
                    <img src="${s.image}" class="card-img" alt="Servicio">
                    <div class="card-body">
                        <span class="card-category">${s.category}</span>
                        <h3 class="card-title">${s.title}</h3>
                        <p class="card-desc">${s.desc}</p>
                        
                        <div class="card-footer">
                            <div class="card-contact">
                                <i class="fab fa-whatsapp"></i> ${s.phone}
                            </div>
                            <button class="delete-btn" onclick="deleteService(${s.id})">Borrar</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function getPlaceholderImage(cat) {
            if(cat === 'Electricidad') return 'https://img.freepik.com/free-photo/electrician-working-switchboard_1098-18766.jpg';
            if(cat === 'Plomer√≠a') return 'https://img.freepik.com/free-photo/plumber-fixing-sink-pipe-with-adjustable-wrench_23-2149359369.jpg';
            if(cat === 'Refrigeraci√≥n') return 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQxQ0H7Q3_d5YtG5Qj5J8X9X5X5X5X5X5X5X5X5w&s'; 
            if(cat === 'Tecnolog√≠a') return 'https://img.freepik.com/free-photo/technician-repairing-computer-computer-hardware-repairing-upgrade-technology_1150-8720.jpg';
            return 'https://img.freepik.com/free-photo/handyman-with-tool-belt_1368-325.jpg';
        }
        // --- FIN L√ìGICA DE MURO DE SERVICIOS ---

        // --- L√ìGICA DE CHATBOT ---
        const chatWindow = document.getElementById('chatWindow');
        const chatBody = document.getElementById('chatBody');
        const chatInput = document.getElementById('chatInput');

        function toggleChat() {
            chatWindow.classList.toggle('active');
        }

        function appendMessage(sender, text) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            messageDiv.innerText = text;
            chatBody.appendChild(messageDiv);
            chatBody.scrollTop = chatBody.scrollHeight;
        }
        
        function openRegistrationAndCloseChat() {
            toggleChat(); 
            openModal();
            if (!isAuthorizedToPublish) {
                document.getElementById('modalAccessFeedback').style.color = 'var(--neon-blue)';
                document.getElementById('modalAccessFeedback').innerText = 'üö® Por favor, introduce tu c√≥digo de publicaci√≥n para continuar.';
            }
        }

        function getBotResponse(input) {
            const lowerInput = input.toLowerCase();

            if (lowerInput.includes('hola') || lowerInput.includes('saludo')) {
                return "¬°Hola! Bienvenido al Muro de Servicios. ¬øQuieres publicar un servicio? Haz clic en el bot√≥n 'üìù Publicar Servicio Ahora' y te pedir√© el c√≥digo de acceso.";
            } 
            else if (lowerInput.includes('registro') || lowerInput.includes('registrar') || lowerInput.includes('publicar')) {
                return "Para publicar un servicio, haz clic en el bot√≥n **'üìù Publicar Servicio Ahora'** o en el bot√≥n principal 'Publicar Servicio'. El sistema te pedir√° el c√≥digo de seguridad.";
            } 
            else if (lowerInput.includes('funciona')) {
                return "El Muro de Servicios es una plataforma donde los profesionales publican sus ofertas. Los clientes pueden contactarte directamente por WhatsApp/tel√©fono. Los datos se guardan solo en tu navegador (Local Storage).";
            } else if (lowerInput.includes('soporte') || lowerInput.includes('t√©cnico')) {
                return "Para soporte t√©cnico avanzado, por favor contacta al administrador. Si es un problema simple de la web, intenta refrescar la p√°gina.";
            } else if (lowerInput.includes('gracias') || lowerInput.includes('adios')) {
                return "¬°Un placer ayudarte! Si necesitas algo m√°s, no dudes en preguntar.";
            } else {
                return "Lo siento, no entend√≠ tu pregunta. Intenta con una de las opciones r√°pidas o s√© m√°s espec√≠fico.";
            }
        }

        function sendQuickMessage(message) {
            appendMessage('user', message);
            setTimeout(() => {
                const response = getBotResponse(message);
                appendMessage('bot', response);
            }, 500);
        }

        function sendMessage() {
            const input = chatInput.value.trim();
            if (input === "") return;

            appendMessage('user', input);
            chatInput.value = '';

            setTimeout(() => {
                const response = getBotResponse(input);
                appendMessage('bot', response);
            }, 500);
        }
    </script>
</body>
</html>